{% extends "base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
<h1>{{ post.title }} ({{ post.language }})</h1>
<p><small>{{ post.path }}</small></p>
<div>{{ html_body|safe }}</div>
<p>Tags:
  {% for tag in post.tags %}
    <a href="{{ url_for('tag_filter', name=tag.name) }}">{{ tag.name }}</a>
  {% endfor %}
</p>
{% if metadata or user_metadata %}
<section>
  <h2>Metadata</h2>
  {% if metadata %}
  <h3>Common</h3>
  <ul>
    {% for key, value in metadata.items() %}
      <li><strong>{{ key }}:</strong> {{ value|format_metadata }}</li>
    {% endfor %}
  </ul>
  {% endif %}
  {% if user_metadata %}
  <h3>Your Metadata</h3>
  <ul>
    {% for key, value in user_metadata.items() %}
      <li><strong>{{ key }}:</strong> {{ value|format_metadata }}</li>
    {% endfor %}
  </ul>
  {% endif %}
</section>
{% endif %}
{% if citations or user_citations %}
<section>
  <h2>Citations</h2>
  {% if citations %}
  <h3>Common</h3>
  <ul>
    {% for c in citations %}
      <li><strong>{{ c.citation_part|format_metadata }}:</strong> {{ c.citation_text }}
        {% if current_user.is_authenticated and (current_user.id == c.user_id or current_user.is_admin()) %}
          <a href="{{ url_for('edit_citation', post_id=post.id, cid=c.id) }}">Edit</a>
          <form action="{{ url_for('delete_citation', post_id=post.id, cid=c.id) }}" method="post" style="display:inline">
            <button type="submit">Delete</button>
          </form>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
  {% endif %}
  {% if user_citations %}
  <h3>Your Citations</h3>
  <ul>
    {% for c in user_citations %}
      <li><strong>{{ c.citation_part|format_metadata }}:</strong> {{ c.citation_text }}
        <a href="{{ url_for('edit_citation', post_id=post.id, cid=c.id) }}">Edit</a>
        <form action="{{ url_for('delete_citation', post_id=post.id, cid=c.id) }}" method="post" style="display:inline">
          <button type="submit">Delete</button>
        </form>
      </li>
    {% endfor %}
  </ul>
  {% endif %}
</section>
{% endif %}
{% if current_user.is_authenticated %}
<section>
  <h2>Add Citation</h2>
  <form action="{{ url_for('new_citation', post_id=post.id) }}" method="post">
    <p><textarea name="citation_part" placeholder="Citation part (JSON)" rows="4" cols="50"></textarea></p>
    <p><textarea name="citation_text" placeholder="Citation text" rows="4" cols="50"></textarea></p>
    <p><button type="submit">Add Citation</button></p>
  </form>
</section>
{% endif %}
{% if translations %}
<p>Other languages:
  {% for t in translations %}
    <a href="{{ url_for('document', language=t.language, doc_path=t.path) }}">{{ t.language }}</a>
  {% endfor %}
</p>
{% endif %}
<p>
  <a href="{{ url_for('history', post_id=post.id) }}">History</a>
  {% if current_user.is_authenticated and (current_user.id == post.author_id or current_user.is_admin()) %}
    | <a href="{{ url_for('edit_post', post_id=post.id) }}">Edit</a>
  {% endif %}
</p>
{% endblock %}
